!pip install opencv-python numpy matplotlib ultralytics

from ultralytics import YOLO
import cv2
import numpy as np
import os
import torch
import torch.nn as nn
import torch.optim as optim
import random
from collections import deque, defaultdict

# YOLOv8 ëª¨ë¸ ë¡œë“œ
model = YOLO("yolov8n.pt")  # ê°€ì¥ ê°€ë²¼ìš´ ëª¨ë¸

from google.colab import files
uploaded = files.upload()

# ì—…ë¡œë“œëœ íŒŒì¼ëª… ì¶”ì¶œ
video_path = next(iter(uploaded))

# replay
class ReplayBuffer:
    def __init__(self, capacity=500):
        self.buffer = deque(maxlen=capacity)

    def add(self, x_vec, label):
        self.buffer.append((x_vec, label))

    def sample(self, batch_size=32):
        batch = random.sample(self.buffer, min(len(self.buffer), batch_size))
        xs, ys = zip(*batch)
        xs = torch.tensor(xs, dtype=torch.float32)
        ys = torch.tensor(ys, dtype=torch.long)
        return xs, ys

    def __len__(self):
        return len(self.buffer)

# ê²°ê³¼ ë¶„ì„
def evaluate_ocl_metrics(all_preds, all_gts, predictions_by_class, groundtruth_by_class):
    print("\n\nğŸ“Š Online Continual Learning Metrics:")
    total_correct = sum(p == g for p, g in zip(all_preds, all_gts))
    acc = total_correct / (len(all_gts) + 1e-6)
    print(f"FM (Final Accuracy): {acc:.4f}")

    seen_classes = sorted(predictions_by_class.keys())
    bwt_values, im_values = [], []

    for c in seen_classes:
        preds = np.array(predictions_by_class[c])
        gts = np.array(groundtruth_by_class[c])
        acc_end = np.mean(preds == gts)
        acc_start = 1.0  # FTRLì€ ì´ˆê¸° ì˜ˆì¸¡ì´ ë¶ˆí™•ì‹¤í•˜ë‹¤ê³  ê°€ì •
        bwt_values.append(acc_end - acc_start)
        im_values.append(acc_start - acc_end)

    bwt = np.mean(bwt_values) if bwt_values else 0.0
    im = np.mean(im_values) if im_values else 0.0

    print(f"BWT (Backward Transfer): {bwt:.4f}")
    print(f"FWT (Forward Transfer): {0.0:.4f}")  # ëª¨ë“  í´ë˜ìŠ¤ ì¦‰ì‹œ í•™ìŠµ
    print(f"IM (Intransigence): {im:.4f}")


